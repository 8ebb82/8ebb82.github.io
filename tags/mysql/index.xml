<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mysql on 8ebb82&#39;s Web Note</title>
    <link>http://8ebb82.github.io/tags/mysql/</link>
    <description>Recent content in Mysql on 8ebb82&#39;s Web Note</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 19 May 2025 18:22:19 +0800</lastBuildDate>
    <atom:link href="http://8ebb82.github.io/tags/mysql/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>无备份恢复数据库</title>
      <link>http://8ebb82.github.io/486504450/</link>
      <pubDate>Mon, 19 May 2025 18:22:19 +0800</pubDate>
      <guid>http://8ebb82.github.io/486504450/</guid>
      <description>&lt;h2 id=&#34;背景&#34;&gt;背景&lt;/h2&gt;&#xA;&lt;p&gt;项目基于&lt;a href=&#34;https://ruoyi.vip/&#34;&gt; ruoyi 框架&lt;/a&gt;二次开发。项目组成员在数据库上运行了 ruoyi 官方提供的 sql 文件，导致系统有关的表格全部被初始内容覆盖，开发过程中所做的更改全部丢失。&lt;/p&gt;&#xA;&lt;p&gt;官方的 sql 文件大概长这样：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;DROP&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;IF&lt;/span&gt; EXIST &lt;span style=&#34;color:#66d9ef&#34;&gt;table_name&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table_name&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table_name&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;VALUES&lt;/span&gt;(...);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;所以看起来就是被初始数据覆盖了。&lt;/p&gt;&#xA;&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;&#xA;&lt;p&gt;询问 ChatGPT，得知可以通过重新执行建库以来所有操作来变相恢复数据。虽然数据库没有备份，但 mysql 会把每一次操作都详细地记录到日志中。&lt;/p&gt;&#xA;&lt;h3 id=&#34;binlog二进制日志&#34;&gt;binlog（二进制日志）&lt;/h3&gt;&#xA;&lt;p&gt;首先看看有没有开启 binlog 功能：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&amp;gt; SHOW BINARY LOGS;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+---------------+-----------+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| Log_name      | File_size | Encrypted |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+---------------+-----------+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| binlog.000005 | &lt;span style=&#34;color:#ae81ff&#34;&gt;120630429&lt;/span&gt; | No        |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| binlog.000006 |       &lt;span style=&#34;color:#ae81ff&#34;&gt;180&lt;/span&gt; | No        |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| binlog.000007 | &lt;span style=&#34;color:#ae81ff&#34;&gt;187911145&lt;/span&gt; | No        |&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+---------------+-----------+-----------+&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; rows in set &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;0.01 sec&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果有，那就有救。&lt;/p&gt;&#xA;&lt;p&gt;文件名后的数字越大表示这个日志文件越新。自行根据数据库出现异常的时间来确定文件。&lt;/p&gt;&#xA;&lt;h3 id=&#34;导出并分析日志&#34;&gt;导出并分析日志&lt;/h3&gt;&#xA;&lt;p&gt;先确定日志文件的路径：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
