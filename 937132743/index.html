<!DOCTYPE html>
<html lang="zh-cn">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ruoyi 权限控制小记 | 8ebb82&#39;s Web Note</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({ startOnLoad: true });
</script>
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/posts/">文章</a></li>
      
      <li><a href="/tags/">标签</a></li>
      
      <li><a href="/categories/">分类</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
    <h1>
        <span class="title">
            Ruoyi 权限控制小记
        </span>
    </h1>
    
    <h2 class="date">2025/05/05</h2>
    <p class="description">ruoyi 框架的权限控制都在哪些地方有？如何使用？</p>
</div>

<main>
    <p>ruoyi 框架的权限控制是通过两个模块实现的：</p>
<ol>
<li><strong>角色管理</strong>：管理角色，为角色分配权限（通过分配权限字符串实现）。</li>
<li><strong>用户管理</strong>：管理用户实体（用于<strong>登录系统的帐号密码</strong>等）。</li>
</ol>
<p>可以<strong>将角色分配给用户</strong>，这样用户就<strong>具有了对应角色的权限</strong>。admin 用户无视所有权限限制。</p>
<hr>
<p>以 <code>SJ36</code> 为例，权限字符串会出现在以下位置：</p>
<h2 id="前端">前端</h2>
<p><code>index.vue</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">el-button</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;primary&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plain</span> <span style="color:#a6e22e">icon</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;el-icon-plus&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mini&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;handleAdd&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">v-hasPermi</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;tunnel:SJ36:add&#39;]&#34;</span>
</span></span><span style="display:flex;"><span>&gt;新增&lt;/<span style="color:#f92672">el-button</span>&gt;
</span></span></code></pre></div><p>若用户不具有 <code>tunnel:SJ36:add</code> 这个权限，在网页上是<strong>看不到</strong><code>新增</code>这个按钮的。</p>
<h2 id="后端">后端</h2>
<p><code>controller</code> 层：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 新增地连墙工程挖槽班报记录表  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@PreAuthorize</span>(<span style="color:#e6db74">&#34;@ss.hasPermi(&#39;tunnel:SJ36:add&#39;)&#34;</span>)  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Log</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;地连墙工程挖槽班报记录表&#34;</span>, businessType <span style="color:#f92672">=</span> BusinessType.<span style="color:#a6e22e">INSERT</span>)  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@PostMapping</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> AjaxResult <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">@RequestBody</span> Sj36 sJ36)  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> toAjax(Sj36Service.<span style="color:#a6e22e">insertSj36</span>(sJ36));  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>若用户不具有 <code>tunnel:SJ36:add</code> 这个权限，在向后端发送相应的请求时，后端<strong>不会执行相应操作</strong>，前端会提示<strong>无操作权限</strong>。</p>
<h2 id="数据库">数据库</h2>
<p><code>sys_menu</code> 表中的 <code>perms</code> 列是权限字符串。</p>
<p>执行 <code>select menu_name,perms from sys_menu where sys_menu.perms like '%sj36%';</code> 进行查询，查看返回的记录：</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">menu_name</th>
          <th style="text-align: center">perms</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">地连墙工程挖槽班报记录表</td>
          <td style="text-align: center">tunnel:SJ36:list</td>
      </tr>
      <tr>
          <td style="text-align: center">地连墙工程挖槽班报记录表</td>
          <td style="text-align: center">tunnel:SJ36:query</td>
      </tr>
      <tr>
          <td style="text-align: center">地连墙工程挖槽班报记录表</td>
          <td style="text-align: center">tunnel:SJ36:add</td>
      </tr>
      <tr>
          <td style="text-align: center">地连墙工程挖槽班报记录表</td>
          <td style="text-align: center">tunnel:SJ36:edit</td>
      </tr>
      <tr>
          <td style="text-align: center">地连墙工程挖槽班报记录表</td>
          <td style="text-align: center">tunnel:SJ36:remove</td>
      </tr>
  </tbody>
</table>
<p>这是目前 <code>SJ36</code> 具有的<strong>可分配的权限</strong>。</p>
<p><strong>如果操作涉及数据库</strong>，那么该表中的权限字符串是<strong>权限的来源</strong>。也就是说只有<strong>存在于该表中的权限字符串</strong>才是有效的。新增权限需要在此表内添加新记录。</p>
<p>以上提到的三者一致时，对应功能才能生效（比如查询列表、修改记录等）。</p>
<hr>
<p>前面提到，若用户不具有相应权限，则网页上不会显示相应的元素。可以用于控制元素对用户（其实是角色）的可见性。由于这个操作<strong>不涉及修改数据库</strong>，所以<strong>不需要在数据库中新增</strong>自定义的权限字符串。</p>
<h2 id="控制表单字段">控制表单字段</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">el-form-item</span> <span style="color:#a6e22e">label</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;施工单位&#34;</span> <span style="color:#a6e22e">prop</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;constructionUnit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">el-input</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form.constructionUnit&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;请输入施工单位&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">v-hasPermi</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;tunnel:SJ36:test&#39;]&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">el-form-item</span>&gt;
</span></span></code></pre></div><p>如果没有 <code>tunnel:SJ36:test</code> 这个权限，用户在添加或修改记录的对话框中是看不到输入框的（<code>el-input</code>），只有表单项信息（<code>label</code>）。</p>
<p>如果只是想禁用输入框，可以使用 <code>el-input</code> 自带的属性 <code>disabled</code> ：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">el-input</span> <span style="color:#a6e22e">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form.constructionUnit&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;请输入施工单位&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">:disabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;!checkPermi([&#39;tunnel:sj36:edit_item&#39;])&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">v-hasPermi</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;tunnel:SJ36:test&#39;]&#34;</span>/&gt;
</span></span></code></pre></div><p>这样，若用户不具有 <code>tunnel:sj36:edit_item</code> 这个权限，<code>checkPermi</code> 函数返回 <code>false</code> ，<code>disabled</code> 取反后就是 <code>true</code> ，也就无法修改。</p>
<h2 id="控制表格列">控制表格列</h2>
<p>某些情况下 <code>v-hasPermi</code> 无法生效，如元素标签组件，只能手动设置 <code>v-if</code>。 可以使用<strong>全局权限判断函数</strong> <code>checkPermi</code>，用法和 <code>v-hasPermi</code> 类似。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">el-table-column</span> <span style="color:#a6e22e">label</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;工程名称&#34;</span> <span style="color:#a6e22e">align</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;center&#34;</span> <span style="color:#a6e22e">prop</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projectName&#34;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">v-if</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkPermi([&#39;tunnel:SJ36:test&#39;])&#34;</span>/&gt;
</span></span></code></pre></div><p>如果用户没有 <code>'tunnel:SJ36:test'</code> 这个权限，则在网页中的记录列表无法看到 <code>工程名称</code> 这一列。</p>
<p>类似地，还可以控制其他元素的显隐，比如 <code>&lt;table&gt;</code> 中（查看详情界面）的行、列、单元格等。只需要在对应元素的标签中添加权限校验函数即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;  
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">colspan</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;field-name&#34;</span> <span style="color:#a6e22e">v-if</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkPermi([&#39;tunnel:SJ36:test&#39;])&#34;</span>&gt;施工单位：&lt;/<span style="color:#f92672">td</span>&gt;  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!--code...--&gt;</span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span></code></pre></div><p>这样，不具有 <code>tunnel:SJ36:test</code> 这个权限的话，在查看详情界面的表格中无法看到 <code>施工单位</code> 这一项。</p>
<p>一般来说 <code>checkPermi</code> 的适用范围比 <code>v-hasPermi</code> 更大（？）。</p>
<hr>
<p>参考文章</p>
<p><a href="https://doc.ruoyi.vip/ruoyi-vue/document/qdsc.html#%E6%9D%83%E9%99%90%E4%BD%BF%E7%94%A8">ruoyi 前端手册：权限使用</a></p>

</main>

  <footer>
  
  
  <hr/>
  © 2026 8ebb82&rsquo;s Web Note. Powered by <a href="https://gohugo.io">Hugo</a>.
  
  </footer>
  </body>
</html>
